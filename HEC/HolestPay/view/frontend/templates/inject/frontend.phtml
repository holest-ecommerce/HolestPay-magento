<div id="holestpay-frontend-area" style="display:none"></div>
<!-- Add custom frontend script here if needed. HolestPayCheckout is available globally. -->
<script nonce="<?= $block->getNonce() ?>">
require(['jquery'], function ($) {
    $(function () {
        try {
            var dataEl = document.getElementById('holestpay-context-data');
            if (dataEl) {
                var context = JSON.parse(dataEl.textContent || '{}');
                window.HolestPayCheckout = window.HolestPayCheckout || {};
                window.HolestPayCheckout.context = Object.assign({ orderId: null, customerEmail: null }, window.HolestPayCheckout.context || {}, context);
                
            }

            // Add all required properties
            window.HolestPayCheckout = window.HolestPayCheckout || {};
            
            // Get checkout context data from child block
            var checkoutContextBlock = <?= json_encode($block->getChildBlock('holestpay.checkout.context')) ?>;
            
            
            // POS configuration based on current environment
            window.HolestPayCheckout.POS = <?= json_encode($block->getChildBlock('holestpay.checkout.context')->getPosConfiguration()) ?>;
            window.HolestPayCheckout.environment = '';
            window.HolestPayCheckout.merchant_site_uid = '';
            
            if(window.HolestPayCheckout.POS){
                window.HolestPayCheckout.environment = window.HolestPayCheckout.POS.Environment;
                window.HolestPayCheckout.merchant_site_uid = window.HolestPayCheckout.POS.MerchantsiteUid;
            }
            
            // Site base URL
            window.HolestPayCheckout.site_base_url = <?= json_encode($block->getChildBlock('holestpay.checkout.context')->getSiteBaseUrl()) ?>;
            
            // Current language
            window.HolestPayCheckout.lang = <?= json_encode($block->getChildBlock('holestpay.checkout.context')->getCurrentLanguage()) ?> || 'en';
            window.HolestPayCheckout.hpaylang = window.HolestPayCheckout.lang.substring(0,2);

            // Cart data
            window.HolestPayCheckout.cart = <?= json_encode($block->getChildBlock('holestpay.checkout.context')->getCartData()) ?>;
            
            // HolestPay URL based on environment
            window.HolestPayCheckout.hpay_url = <?= json_encode($block->getChildBlock('holestpay.checkout.context')->getHolestPayUrl()) ?>;
            
            // Translated labels
            window.HolestPayCheckout.labels = <?= json_encode($block->getChildBlock('holestpay.checkout.context')->getLabels()) ?>;

            if(window.checkoutConfig && window.checkoutConfig.payment)
				window.checkoutConfig.payment.holestpay = window.HolestPayCheckout.POS;
            
        } catch (e) { 
            console.error('HolestPayCheckout initialization error:', e);
        }
    });
});
</script>

<?php
// Render custom CSS if configured
$customCss = $block->getChildBlock('holestpay.checkout.context')->getCustomFrontendCss();
if (!empty($customCss)): ?>
<style nonce="<?= $block->getNonce() ?>">
<?= /* @noEscape */ $customCss ?>
</style>
<?php endif; ?>

<?php
// Render custom JS if configured
$customJs = $block->getChildBlock('holestpay.checkout.context')->getCustomFrontendJs();
if (!empty($customJs)): ?>
<script nonce="<?= $block->getNonce() ?>">
<?= /* @noEscape */ $customJs ?>
</script>
<?php endif; ?>


